<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>物业系统管理平台</title>
    <meta name="renderer" content="webkit">
    <script src="scripts/js/jquery-1.11.3.min.js"></script>
    <script src="scripts/js/jquery.cookie.js"></script>
    <link rel="shortcut icon" href="assets/ico/logo.png">
    <link href="scripts/themes/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: "Verdana", "Tahoma", "Lucida Grande", "Microsoft YaHei", "Hiragino Sans GB", sans-serif;
            background: url(images/bg.png) no-repeat center center fixed;
            background-size: cover;
        }

        .divLogo {
            position: absolute;
            top: 24px;
            left: 54px;
            width: 21.25%;
        }

        .divLogo img {
            max-width: 100%;
        }

        .form-control {
            height: 46px;
        }

        /*.main_box{position:absolute; top:45%; left:50%; margin:-160px 0 0 -180px; padding:15px 20px; width:360px;!* height:320px;*! min-width:320px; background:#FAFAFA; background:rgba(255,255,255,0.5); box-shadow: 1px 5px 8px #888888; border-radius:6px;}*/
        .main_box {
            position: absolute;
            top: 45%;
            left: 50%;
            margin: -160px 0 0 -180px;
            padding: 15px 20px;
            width: 360px; /* height:320px;*/
            min-width: 320px;
            background: #fff;
        }

        .login_msg {
            height: 30px;
        }

        .input-group > .input-group-addon.code {
            padding: 0;
        }

        #captcha_img {
            cursor: pointer;
            width: 90%;
            padding-top: 12px
        }

        .main_box .logo img {
            height: 35px;
        }

        @media (min-width: 768px) {
            .main_box {
                margin-left: -240px;
                padding: 15px 55px;
                width: 480px;
            }

            .main_box .logo img {
                height: 40px;
            }
        }

        .divLoginError {
            display: none;
            background-color: #f00;
            color: #fff;
            padding: 10px;
            opacity: 0.7;
        }

        .divLoginBtn {
            margin: 40px 0 30px 0;
        }

        .div-bor {
            position: relative;
            width: 404px;
            height: 50px;
        }

        .icon-user {
            position: absolute;
            left: 13px;
            top: 14px;
            z-index: 5;
            background-image: url('images/user.png'); /*引入图片图片*/
            background-repeat: no-repeat; /*设置图片不重复*/
            background-position: 0px 0px; /*图片显示的位置*/
            width: 20px; /*设置图片显示的宽*/
            height: 20px; /*图片显示的高*/
        }

        .icon-psw {
            position: absolute;
            left: 13px;
            top: 13px;
            z-index: 5;
            background-image: url('images/psw.png'); /*引入图片图片*/
            background-repeat: no-repeat; /*设置图片不重复*/
            background-position: 0px 0px; /*图片显示的位置*/
            width: 20px; /*设置图片显示的宽*/
            height: 20px; /*图片显示的高*/
        }

        .user {
            padding-left: 40px;
            /*background-color: rgba(216,216,216,0.29)!important;*/
            /*background-color: blue!important;*/
        }

        .input-group-addon1 {
            font-size: 14px;
            font-weight: 400;
            line-height: 1;
            color: #555;
            text-align: center;
        }

        #selectType ul {
            list-style: none;
            overflow: hidden;
            margin:0;
            padding:0;
        }

        #selectType ul li {
            cursor: pointer;
            float: left;
            width: 34%;
            text-align: center;
            margin-bottom: 50px;
        }

        .centerArea {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 320px;
            /*background: #fff;*/
            width: 80%;
        }

        .territory{
            width: 80%;
            height: 214px;
            margin: 0 auto;
            box-shadow: 0 0 19px 6px rgba(0,0,0,0.3);
            border-radius: 5px;
            /* background-size: cover; */
            position: relative;
        }

        .territoryBg1{
            background: #fff url(images/territory1.png) no-repeat center -14px;
            background-size: 100%;
        }
        .territoryBg2{
            background: #fff url(images/territory2.png) no-repeat center -14px;
            background-size: 100%;
        }
        .territoryBg3{
            background: #fff url(images/territory3.png) no-repeat center -14px;
            background-size: 100%;
        }

        .territoryName{
            font-size: 19px;
            font-family: inherit;
            color: #333;
            width: 80%;
            text-align: center;
            position: absolute;
            top: 60px;
            left: 50%;
            margin-left: -40%;
            text-shadow: 4px 3px 5px rgba(0,0,0,0.3);
        }
        .enterBtn{
            width: 130px;
            text-align: center;
            color: #4371B7;
            border-radius: 16px;
            position: absolute;
            bottom: 24px;
            left: 50%;
            margin-left: -65px;
            border: 1px solid #4371B7;
            height: 32px;
            line-height: 32px;
        }
        .divNoticeInfo{ display: none; position: fixed; z-index: 10; width: 260px; height: 120px; padding: 20px; top:40%; left: 50%; margin: -70px 0 0 -110px; background: #fff; border: #888 1px solid; text-align: center; border-radius: 6px;  box-shadow: 0 0 19px 6px rgba(0,0,0,0.17);}
        .divNoticeInfo span{ display: block; text-align: center; font-size: 20px;}
        .divNoticeInfo .a_close{ display: inline-block; text-decoration: none;  border: #f00 1px solid;  width: 70px;  height: 30px;  border-radius: 4px;  line-height: 28px; color: #f00; font-size: 14px; position: relative; top: 15px;}
    </style>
    <script type="text/javascript">
        var COOKIE_NAME = 'sys_em_username';
        $(function () {
            //choose_bg();
            changeCode();
            /*if ($.cookie(COOKIE_NAME)){
             $("#j_username").val($.cookie(COOKIE_NAME));
             $("#j_password").focus();
             $("#j_remember").attr('checked', true);
             } else {
             $("#j_username").focus();
             }*/
            $("#captcha_img").click(function () {
                changeCode();
            });
        });
        function changeCode() {
            $("#captcha_img").attr("src", "web/admin/v1/validateCode?t=" + (new Date().getTime()));
        }
        window.setInterval(function () {
            changeCode()
        }, 180000);

        function choose_bg() {
            var bg = Math.floor(Math.random() * 9 + 1);
            $('body').css('background-image', 'url(images/loginbg_0' + bg + '.jpg)');
        }
    </script>
    <script src="scripts/js/common/common.js"></script>
</head>
<body>
<!--[if lte IE 7]>
<style type="text/css">
    #errorie {
        position: fixed;
        top: 0;
        z-index: 100000;
        height: 30px;
        background: #FCF8E3;
    }

    #errorie div {
        width: 900px;
        margin: 0 auto;
        line-height: 30px;
        color: orange;
        font-size: 14px;
        text-align: center;
    }

    #errorie div a {
        color: #459f79;
        font-size: 14px;
    }

    #errorie div a:hover {
        text-decoration: underline;
    }


</style>
<div id="errorie">
    <div>您还在使用老掉牙的IE，请升级您的浏览器到 IE8以上版本 <a target="_blank"
                                          href="http://windows.microsoft.com/zh-cn/internet-explorer/ie-8-worldwide-languages">点击升级</a>&nbsp;&nbsp;强烈建议您更改换浏览器：<a
            href="http://down.tech.sina.com.cn/content/40975.html" target="_blank">谷歌 Chrome</a></div>
</div>
<![endif]-->
<div class="divLogo"><a href="javascript:void(0)" onclick="skip()"><img src="images/logo.png"/></a></div>
<script>
    function skip() {
        var path = window.location.href;
        path = path.substring(0, path.lastIndexOf(path.split(":")[2]) - 1);
        window.open(path);
    }
</script>
<div class="container">
    <!--<div class="main_box" style="width: 530px;height: 430px">-->
    <div class="main_box" style="width: 510px;height: 380px">
        <form id="login_form" style="padding-left: 0;padding-top: 24px;">
            <input type="hidden" value="" id="j_randomKey"/>
            <input type="hidden" name="jfinal_token" value=""/>
            <!--<p class="text-center logo"><img src="images/logo.png" height="45"></p>-->
            <p class="text-center logo"
               style="font-family: PingFangSC-Medium;font-size: 22px;position: relative;color: #333333;top: -15px;">
                物业系统管理平台</p>
            <!-- <div class="login_msg text-center"><font color="red"></font></div> -->
            <div class="form-group">
                <div class="input-group">
                    <!--<span class="input-group-addon" id="sizing-addon-user"><span class="glyphicon glyphicon-user"></span></span>-->
                    <div class="div-bor">
                        <i class="icon-user"></i>
                        <input type="text" class="form-control user" id="j_username" name="username" value=""
                               placeholder="登录账号" aria-describedby="sizing-addon-user"
                               style="-webkit-box-shadow: 0 0 0px 1000px #F4F4F4 inset;border-color:#fff " autofocus>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <!--<span class="input-group-addon" id="sizing-addon-password"><span class="glyphicon glyphicon-lock"></span></span>-->
                    <!--<input type="password" class="form-control" id="j_password" name="passwordhash" placeholder="登录密码"  aria-describedby="sizing-addon-password"/>-->
                    <div class="div-bor">
                        <i class="icon-psw"></i>
                        <input type="password" class="form-control user" id="j_password"
                               style="-webkit-box-shadow: 0 0 0px 1000px #F4F4F4 inset;border-color:#fff "
                               name="passwordhash"
                               placeholder="登录密码" aria-describedby="sizing-addon-password"/>
                    </div>
                </div>
            </div>
            <div class="form-group" style="margin-bottom: -3px;">
                <div class="input-group" style="display: inline-block">
                    <!--<span class="input-group-addon" id="sizing-addon-code"><span class="glyphicon glyphicon-exclamation-sign"></span></span>-->
                    <input type="text" class="form-control "
                           style="width: 260px;padding-left: 15px;-webkit-box-shadow: 0 0 0px 1000px #F4F4F4 inset;border-color:#fff "
                           id="j_captcha"
                           name="captcha" placeholder="验证码" aria-describedby="sizing-addon-password">
                </div>
                <span class="input-group-addon1 code" id="basic-addon-code"
                      style="width:120px;display: inline-block;vertical-align: middle;position: relative;top: -25px;left: 18px;"><img
                        id="captcha_img" src="web/admin/v1/validateCode" alt="点击更换" title="点击更换" class="m"></span>
            </div>
            <!--<div class="form-group">
                <div class="checkbox">
                    <label for="j_remember" class="m"><input id="j_remember" type="checkbox" value="true">&nbsp;记住登陆账号!</label>
                </div>
            </div>-->
            <div class="divLoginError"></div>
            <!--<div class="text-center divLoginBtn">-->
            <!--<button type="button" id="login_ok" class="btn btn-primary btn-lg">&nbsp;登&nbsp;录&nbsp;</button>&nbsp;&nbsp;&nbsp;&nbsp;-->
            <!--&lt;!&ndash;<button type="button" class="btn btn-default btn-lg">&nbsp;重&nbsp;置&nbsp;</button>&ndash;&gt;-->
            <!--</div>-->
            <div style="cursor: pointer;background: #06A3EA;width: 100%;height: 62px;line-height:62px;position: absolute;bottom: 0;left: 0;text-align: center;font-family: PingFangSC-Semibold;font-size: 20px;color: #FFFFFF;"
                 id="login_ok">
                登录
            </div>
        </form>
    </div>
    <div id="selectType" style="display: none">
        <ul>

        </ul>
    </div>
</div>
<div class="divNoticeInfo" id="divNoticeInfo">
    <span>您的账号已被禁用!</span>
    <a href="javascript:void($('.divNoticeInfo').hide())" class="a_close">关闭</a>
</div>
</body>
<script>
    $(function () {
        $("#j_username").focus();

        /*登录*/
        $("#login_ok").click(function () {
            var userName = $("#j_username").val().trim();
            var password = $("#j_password").val();
            var code = $("#j_captcha").val();
            if (userName == "" || userName == null) {
                $("#j_username").css("border", "1px solid rgb(255, 0, 0)");
                $(".divLoginError").text("登录账号不能为空!").show().delay(2000).fadeOut(1500);
                return;
            } else {
                $("#j_username").removeAttr("style");
            }
            if (password == "" || password == null) {
                $("#j_password").css("border", "1px solid rgb(255, 0, 0)");
                $(".divLoginError").text("登录密码不能为空!").show().delay(2000).fadeOut(1500);
                return;
            } else {
                $("#j_password").removeAttr("style");
            }

            if (code == "" || code == null) {
                $("#j_captcha").css("border", "1px solid rgb(255, 0, 0)");
                $(".divLoginError").text("验证码不能为空!").show().delay(2000).fadeOut(1500);
                return;
            } else {
                $("#j_captcha").removeAttr("style");
            }

            var data = {"account": userName, "password": password, "validateCode": code};
            $.ajax({
                type: "POST",
                url: "web/admin/v1/login",
                data: JSON.stringify(data),
                contentType: 'application/json;charset=UTF-8',
                dataType: 'json',
                cache: false,
                success: function (json) {
                    if (json.code == "00000") {
                        $.cookie("l_userId", json.data.userId, {path: '/', expires: 15});
                        $.cookie("l_token", json.data.token, {path: '/', expires: 15});
                        if (json.data.isInit == "1") {  //非初始状态，不需要强制修改密码
//                            window.location.href = 'index.html';
                            $.ajax({
                                type: "POST",
                                url: "web/admin/v1/findEstates",
                                data: '',
                                contentType: 'application/json;charset=UTF-8',
                                dataType: 'json',
                                cache: false,
                                headers: {"userId": $.cookie("l_userId"), "token": $.cookie("l_token")},
                                success: function (returnData) {
                                    console.log(returnData)
                                    var data = returnData.data;
                                    if(data.length==0){
                                        changeCode();
                                        $(".divLoginError").text("您没有任何楼盘的访问权限!").show().delay(2000).fadeOut(1500);
                                        return
                                    }
                                    $('#selectType ul').empty();
                                    for (var i = 0; i < data.length; i++) {
                                        var arr = ["territoryBg1","territoryBg2","territoryBg3"];
                                        var index = Math.floor((Math.random()*arr.length));
                                        var html = '<li id="' + data[i].estateId + '"><div class="territory '+arr[index]+'"><div class="territoryName">' + data[i].estateName + '</div><div class="enterBtn">进入项目</div></div></li>'
                                        $('#selectType ul').append(html);
                                    }
                                    $('.main_box').animate({'top': '-380px'}, 'slow', 'linear').fadeOut(function () {
                                        $('#selectType').addClass('centerArea').fadeIn('slow');
                                    });
                                }
                            });


                        } else {
                            window.location.href = 'changePWD.html';
                        }
                    } else if (json.code == "L0001") {
                        changeCode();
                        $(".divLoginError").text("账号或密码错误!").show().delay(2000).fadeOut(1500);
                    } else if (json.code == "L0002") {
                        changeCode();
                        $(".divLoginError").text("验证码不能为空!").show().delay(2000).fadeOut(1500);
                    } else if (json.code == "L0003") {
                        changeCode();
                        $(".divLoginError").text("验证码错误!").show().delay(2000).fadeOut(1500);
                    } else if (json.code == "L0004") {
                        changeCode();
                        $(".divLoginError").text("没有该系统权限!").show().delay(2000).fadeOut(1500);
                    } else if (json.code == "L0005") {
                        changeCode();
                        $(".divLoginError").text("验证码已失效!").show().delay(2000).fadeOut(1500);
                    } else if (json.code == "L0006") {
                        changeCode();
                        $(".divLoginError").text("账号未启用!").show().delay(2000).fadeOut(1500);
                    }
                },
                error: function (json) {
                }
            });
        });

        $('.container').on('click', '#selectType li', function () {
            var id = $(this).attr('id');
            $.ajax({
                type: "POST",
                url: "web/admin/v1/findSystems",
                data:JSON.stringify({'estateId':id}) ,
                contentType: 'application/json;charset=UTF-8',
                dataType: 'json',
                cache: false,
                headers:{"userId":$.cookie("l_userId"),"token":$.cookie("l_token")},
                success: function (returnData) {
                    if(returnData.code=='L0006'){
                        $(".divNoticeInfo").show().delay(3000).fadeOut(500);
                        return
                    }
                    var Jurisdiction=returnData.data.privilegeInfos;
                    if(Jurisdiction.length==0){
                        $(".divNoticeInfo").show().delay(3000).fadeOut(500);
                        return
                    }
                    window.location.href = 'viewPager.html?' + id;
                }
            });
        });

        //所需单据绑定回车键
        $("#j_captcha").keydown(function (event) {
            if (event.keyCode == 13) {
                $("#login_ok").click();
            }
        });
    });
</script>
</html>